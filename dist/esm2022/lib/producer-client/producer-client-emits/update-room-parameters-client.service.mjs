/* eslint-disable @typescript-eslint/no-non-null-assertion */
// room.service.ts
import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "../../methods/utils/producer/video-capture-constraints.service";
import * as i2 from "../../methods/utils/producer/h-params.service";
import * as i3 from "../../methods/utils/producer/v-params.service";
import * as i4 from "../../methods/utils/producer/screen-params.service";
import * as i5 from "../../methods/utils/producer/a-params.service";
export class UpdateRoomParametersClient {
    videoCaptureConstraints;
    hParams;
    vParams;
    screenParams;
    aParams;
    constructor(videoCaptureConstraints, hParams, vParams, screenParams, aParams) {
        this.videoCaptureConstraints = videoCaptureConstraints;
        this.hParams = hParams;
        this.vParams = vParams;
        this.screenParams = screenParams;
        this.aParams = aParams;
    }
    /**
     * Update Room Parameters Client after the user has joined the room and the room parameters have been received from the server.
     * @param {Object} parameters - An object containing various parameters and update functions.
     */
    updateRoomParametersClient = ({ parameters }) => {
        try {
            const { screenPageLimit, shareScreenStarted, shared, hParams, vParams, frameRate, islevel, showAlert, data, 
            //updates
            updateRtpCapabilities, updateRoomRecvIPs, updateMeetingRoomParams, updateItemPageLimit, updateAudioOnlyRoom, updateScreenPageLimit, updateVidCons, updateFrameRate, updateAdminPasscode, updateEventType, updateYouAreCoHost, updateAutoWave, updateForceFullDisplay, updateChatSetting, updateMeetingDisplayType, updateAudioSetting, updateVideoSetting, updateScreenshareSetting, updateHParams, updateVParams, updateScreenParams, updateAParams, updateTargetResolution, updateTargetResolutionHost, 
            // Recording updates
            updateRecordingAudioPausesLimit, updateRecordingAudioPausesCount, updateRecordingAudioSupport, updateRecordingAudioPeopleLimit, updateRecordingAudioParticipantsTimeLimit, updateRecordingVideoPausesCount, updateRecordingVideoPausesLimit, updateRecordingVideoSupport, updateRecordingVideoPeopleLimit, updateRecordingVideoParticipantsTimeLimit, updateRecordingAllParticipantsSupport, updateRecordingVideoParticipantsSupport, updateRecordingAllParticipantsFullRoomSupport, updateRecordingVideoParticipantsFullRoomSupport, updateRecordingPreferredOrientation, updateRecordingSupportForOtherOrientation, updateRecordingMultiFormatsSupport, updateRecordingVideoOptions, updateRecordingAudioOptions, updateMainHeightWidth, } = parameters;
            if (data.rtpCapabilities == null) {
                let reason = data.reason || '';
                showAlert?.({
                    message: 'Sorry, you are not allowed to join this room. ' + reason,
                    type: 'danger',
                    duration: 3000,
                });
                return;
            }
            // Update all values
            updateRtpCapabilities(data.rtpCapabilities);
            updateAdminPasscode(data.secureCode);
            updateRoomRecvIPs(data.roomRecvIPs);
            updateMeetingRoomParams(data.meetingRoomParams);
            // Update recording values
            updateRecordingAudioPausesLimit(data.recordingParams.recordingAudioPausesLimit);
            updateRecordingAudioPausesCount(data.recordingParams.recordingAudioPausesCount);
            updateRecordingAudioSupport(data.recordingParams.recordingAudioSupport);
            updateRecordingAudioPeopleLimit(data.recordingParams.recordingAudioPeopleLimit);
            updateRecordingAudioParticipantsTimeLimit(data.recordingParams.recordingAudioParticipantsTimeLimit);
            updateRecordingVideoPausesCount(data.recordingParams.recordingVideoPausesCount);
            updateRecordingVideoPausesLimit(data.recordingParams.recordingVideoPausesLimit);
            updateRecordingVideoSupport(data.recordingParams.recordingVideoSupport);
            updateRecordingVideoPeopleLimit(data.recordingParams.recordingVideoPeopleLimit);
            updateRecordingVideoParticipantsTimeLimit(data.recordingParams.recordingVideoParticipantsTimeLimit);
            updateRecordingAllParticipantsSupport(data.recordingParams.recordingAllParticipantsSupport);
            updateRecordingVideoParticipantsSupport(data.recordingParams.recordingVideoParticipantsSupport);
            updateRecordingAllParticipantsFullRoomSupport(data.recordingParams.recordingAllParticipantsFullRoomSupport);
            updateRecordingVideoParticipantsFullRoomSupport(data.recordingParams.recordingVideoParticipantsFullRoomSupport);
            updateRecordingPreferredOrientation(data.recordingParams.recordingPreferredOrientation);
            updateRecordingSupportForOtherOrientation(data.recordingParams.recordingSupportForOtherOrientation);
            updateRecordingMultiFormatsSupport(data.recordingParams.recordingMultiFormatsSupport);
            // Update other meeting room settings
            updateItemPageLimit(data.meetingRoomParams.itemPageLimit);
            updateEventType(data.meetingRoomParams.type);
            if (data.meetingRoomParams.type == 'chat' && islevel != '2') {
                updateYouAreCoHost(true);
            }
            if (['chat', 'broadcast'].includes(data.meetingRoomParams.type)) {
                updateAutoWave(false);
                updateMeetingDisplayType('all');
                updateForceFullDisplay(true);
                updateChatSetting('allow');
            }
            updateAudioSetting(data.meetingRoomParams.audioSetting);
            updateVideoSetting(data.meetingRoomParams.videoSetting);
            updateScreenshareSetting(data.meetingRoomParams.screenshareSetting);
            updateChatSetting(data.meetingRoomParams.chatSetting);
            updateAudioOnlyRoom(data.meetingRoomParams.mediaType != 'video');
            if (data.meetingRoomParams.type == 'chat' || data.meetingRoomParams.type == 'broadcast') {
                if (data.meetingRoomParams.type == 'broadcast') {
                    updateItemPageLimit(1);
                    updateRecordingVideoOptions('mainScreen');
                    updateRecordingAudioOptions('host');
                }
                else {
                    updateItemPageLimit(2);
                }
            }
            if (data.meetingRoomParams.type == 'conference' && (shared || shareScreenStarted)) {
                updateMainHeightWidth(100);
            }
            else {
                updateMainHeightWidth(0);
            }
            updateScreenPageLimit(Math.min(data.meetingRoomParams.itemPageLimit, screenPageLimit));
            // Assign media capture constraints based on the user's role and room settings
            let targetOrientation = islevel == '2'
                ? data.meetingRoomParams.targetOrientationHost
                : data.meetingRoomParams.targetOrientation;
            let targetResolution = islevel == '2'
                ? data.meetingRoomParams.targetResolutionHost
                : data.meetingRoomParams.targetResolution;
            let vidCons;
            if (targetOrientation == 'landscape') {
                vidCons =
                    targetResolution == 'hd'
                        ? this.videoCaptureConstraints.hdCons
                        : targetResolution == 'QnHD'
                            ? this.videoCaptureConstraints.QnHDCons
                            : targetResolution == 'fhd'
                                ? this.videoCaptureConstraints.fhdCons
                                : targetResolution == 'qhd'
                                    ? this.videoCaptureConstraints.qhdCons
                                    : this.videoCaptureConstraints.sdCons;
            }
            else if (targetOrientation == 'neutral') {
                vidCons =
                    targetResolution == 'hd'
                        ? this.videoCaptureConstraints.hdConsNeu
                        : targetResolution == 'QnHD'
                            ? this.videoCaptureConstraints.QnHDConsNeu
                            : targetResolution == 'fhd'
                                ? this.videoCaptureConstraints.fhdConsNeu
                                : targetResolution == 'qhd'
                                    ? this.videoCaptureConstraints.qhdConsNeu
                                    : this.videoCaptureConstraints.sdConsNeu;
            }
            else {
                vidCons =
                    targetResolution == 'hd'
                        ? this.videoCaptureConstraints.hdConsPort
                        : targetResolution == 'QnHD'
                            ? this.videoCaptureConstraints.QnHDConsPort
                            : targetResolution == 'fhd'
                                ? this.videoCaptureConstraints.fhdConsPort
                                : targetResolution == 'qhd'
                                    ? this.videoCaptureConstraints.qhdConsPort
                                    : this.videoCaptureConstraints.sdConsPort;
            }
            let frameRateValue = frameRate ? frameRate : 10;
            let vParamsValue = { ...vParams };
            let hParamsValue = { ...hParams };
            if (Object.keys(vParamsValue).length === 0) {
                vParamsValue = this.vParams.vParams;
            }
            if (Object.keys(hParamsValue).length === 0) {
                hParamsValue = this.hParams.hParams;
            }
            if (targetResolution == 'hd') {
                frameRateValue = this.videoCaptureConstraints.hdFrameRate;
                vParamsValue.encodings.forEach((encoding) => {
                    encoding.maxBitrate && (encoding.maxBitrate *= 4);
                });
                hParamsValue.encodings.forEach((encoding) => {
                    encoding.maxBitrate && (encoding.maxBitrate *= 4);
                });
            }
            else if (targetResolution == 'QnHD') {
                frameRateValue = this.videoCaptureConstraints.QnHDFrameRate;
                vParamsValue.encodings.forEach((encoding) => {
                    encoding.maxBitrate && (encoding.maxBitrate *= 0.25);
                });
                hParamsValue.encodings.forEach((encoding) => {
                    encoding.maxBitrate && (encoding.maxBitrate *= 0.25);
                });
                hParamsValue.codecOptions.videoGoogleStartBitrate *= 0.25;
                vParamsValue.codecOptions.videoGoogleStartBitrate *= 0.25;
            }
            else if (targetResolution == 'fhd') {
                frameRateValue = this.videoCaptureConstraints.fhdFrameRate;
                vParamsValue.encodings.forEach((encoding) => {
                    encoding.maxBitrate && (encoding.maxBitrate *= 8);
                });
                hParamsValue.encodings.forEach((encoding) => {
                    encoding.maxBitrate && (encoding.maxBitrate *= 8);
                });
                hParamsValue.codecOptions.videoGoogleStartBitrate *= 8;
                vParamsValue.codecOptions.videoGoogleStartBitrate *= 8;
            }
            else if (targetResolution == 'qhd') {
                frameRateValue = this.videoCaptureConstraints.qhdFrameRate;
                vParamsValue.encodings.forEach((encoding) => {
                    encoding.maxBitrate && (encoding.maxBitrate *= 16);
                });
                hParamsValue.encodings.forEach((encoding) => {
                    encoding.maxBitrate && (encoding.maxBitrate *= 16);
                });
                hParamsValue.codecOptions.videoGoogleStartBitrate *= 16;
                vParamsValue.codecOptions.videoGoogleStartBitrate *= 16;
            }
            if (data.recordingParams.recordingVideoSupport) {
                vParamsValue.encodings.forEach((encoding) => {
                    encoding.maxBitrate && (encoding.maxBitrate *= 1.2);
                });
                hParamsValue.encodings.forEach((encoding) => {
                    encoding.maxBitrate && (encoding.maxBitrate *= 1.2);
                });
                hParamsValue.codecOptions.videoGoogleStartBitrate *= 1.2;
                vParamsValue.codecOptions.videoGoogleStartBitrate *= 1.2;
            }
            updateVidCons(vidCons);
            updateFrameRate(frameRateValue);
            updateHParams(hParamsValue);
            updateVParams(vParamsValue);
            updateScreenParams(this.screenParams.screenParams);
            updateAParams(this.aParams.aParams);
            updateTargetResolution(data.meetingRoomParams.targetResolution);
            updateTargetResolutionHost(data.meetingRoomParams.targetResolutionHost);
        }
        catch (error) {
            console.log('updateRoomParametersClient error', error);
            parameters.showAlert?.({
                message: error.message,
                type: 'danger',
                duration: 3000,
            });
        }
    };
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.8", ngImport: i0, type: UpdateRoomParametersClient, deps: [{ token: i1.VideoCaptureConstraints }, { token: i2.HParams }, { token: i3.VParams }, { token: i4.ScreenParams }, { token: i5.AParams }], target: i0.ɵɵFactoryTarget.Injectable });
    static ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.2.8", ngImport: i0, type: UpdateRoomParametersClient, providedIn: 'root' });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.8", ngImport: i0, type: UpdateRoomParametersClient, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: () => [{ type: i1.VideoCaptureConstraints }, { type: i2.HParams }, { type: i3.VParams }, { type: i4.ScreenParams }, { type: i5.AParams }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlLXJvb20tcGFyYW1ldGVycy1jbGllbnQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21lZGlhc2Z1LWFuZ3VsYXIvc3JjL2xpYi9wcm9kdWNlci1jbGllbnQvcHJvZHVjZXItY2xpZW50LWVtaXRzL3VwZGF0ZS1yb29tLXBhcmFtZXRlcnMtY2xpZW50LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsNkRBQTZEO0FBQzdELGtCQUFrQjtBQUNsQixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7Ozs7O0FBNEczQyxNQUFNLE9BQU8sMEJBQTBCO0lBRTNCO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFMVixZQUNVLHVCQUFnRCxFQUNoRCxPQUFnQixFQUNoQixPQUFnQixFQUNoQixZQUEwQixFQUMxQixPQUFnQjtRQUpoQiw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQXlCO1FBQ2hELFlBQU8sR0FBUCxPQUFPLENBQVM7UUFDaEIsWUFBTyxHQUFQLE9BQU8sQ0FBUztRQUNoQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixZQUFPLEdBQVAsT0FBTyxDQUFTO0lBQ3ZCLENBQUM7SUFFSjs7O09BR0c7SUFDSCwwQkFBMEIsR0FBRyxDQUFDLEVBQUUsVUFBVSxFQUFxQyxFQUFRLEVBQUU7UUFDdkYsSUFBSSxDQUFDO1lBQ0gsTUFBTSxFQUNKLGVBQWUsRUFDZixrQkFBa0IsRUFDbEIsTUFBTSxFQUVOLE9BQU8sRUFDUCxPQUFPLEVBQ1AsU0FBUyxFQUVULE9BQU8sRUFDUCxTQUFTLEVBQ1QsSUFBSTtZQUVKLFNBQVM7WUFDVCxxQkFBcUIsRUFDckIsaUJBQWlCLEVBQ2pCLHVCQUF1QixFQUN2QixtQkFBbUIsRUFDbkIsbUJBQW1CLEVBQ25CLHFCQUFxQixFQUNyQixhQUFhLEVBQ2IsZUFBZSxFQUNmLG1CQUFtQixFQUNuQixlQUFlLEVBQ2Ysa0JB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QUUsTUFBTTtpQkFDbkIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uICovXG4vLyByb29tLnNlcnZpY2UudHNcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFZpZGVvQ2FwdHVyZUNvbnN0cmFpbnRzIH0gZnJvbSAnLi4vLi4vbWV0aG9kcy91dGlscy9wcm9kdWNlci92aWRlby1jYXB0dXJlLWNvbnN0cmFpbnRzLnNlcnZpY2UnO1xuaW1wb3J0IHsgSFBhcmFtcywgSFBhcmFtc1R5cGUgfSBmcm9tICcuLi8uLi9tZXRob2RzL3V0aWxzL3Byb2R1Y2VyL2gtcGFyYW1zLnNlcnZpY2UnO1xuaW1wb3J0IHsgVlBhcmFtcywgVlBhcmFtc1R5cGUgfSBmcm9tICcuLi8uLi9tZXRob2RzL3V0aWxzL3Byb2R1Y2VyL3YtcGFyYW1zLnNlcnZpY2UnO1xuaW1wb3J0IHsgU2NyZWVuUGFyYW1zIH0gZnJvbSAnLi4vLi4vbWV0aG9kcy91dGlscy9wcm9kdWNlci9zY3JlZW4tcGFyYW1zLnNlcnZpY2UnO1xuaW1wb3J0IHsgQVBhcmFtcyB9IGZyb20gJy4uLy4uL21ldGhvZHMvdXRpbHMvcHJvZHVjZXIvYS1wYXJhbXMuc2VydmljZSc7XG5pbXBvcnQgeyBSdHBDYXBhYmlsaXRpZXMgfSBmcm9tICdtZWRpYXNvdXAtY2xpZW50L2xpYi90eXBlcyc7XG5pbXBvcnQge1xuICBFdmVudFR5cGUsXG4gIFNob3dBbGVydCxcbiAgVmlkQ29ucyxcbiAgUmVzcG9uc2VKb2luUm9vbSxcbiAgU2NyZWVuUGFyYW1zVHlwZSxcbiAgQVBhcmFtc1R5cGUsXG4gIE1lZXRpbmdSb29tUGFyYW1zLFxufSBmcm9tICcuLi8uLi9AdHlwZXMvdHlwZXMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZVJvb21QYXJhbWV0ZXJzQ2xpZW50UGFyYW1ldGVycyB7XG4gIHJ0cENhcGFiaWxpdGllczogUnRwQ2FwYWJpbGl0aWVzIHwgbnVsbDtcbiAgcm9vbVJlY3ZJUHM6IHN0cmluZ1tdO1xuICBtZWV0aW5nUm9vbVBhcmFtczogTWVldGluZ1Jvb21QYXJhbXMgfCBudWxsO1xuICBpdGVtUGFnZUxpbWl0OiBudW1iZXI7XG4gIGF1ZGlvT25seVJvb206IGJvb2xlYW47XG4gIGFkZEZvckJhc2ljOiBib29sZWFuO1xuICBzY3JlZW5QYWdlTGltaXQ6IG51bWJlcjtcbiAgc2hhcmVTY3JlZW5TdGFydGVkOiBib29sZWFuO1xuICBzaGFyZWQ6IGJvb2xlYW47XG4gIHRhcmdldE9yaWVudGF0aW9uOiBzdHJpbmc7XG4gIHZpZENvbnM6IGFueTtcbiAgcmVjb3JkaW5nVmlkZW9TdXBwb3J0OiBib29sZWFuO1xuICBmcmFtZVJhdGU6IG51bWJlcjtcbiAgYWRtaW5QYXNzY29kZTogc3RyaW5nO1xuICBldmVudFR5cGU6IEV2ZW50VHlwZTtcbiAgeW91QXJlQ29Ib3N0OiBib29sZWFuO1xuICBhdXRvV2F2ZTogYm9vbGVhbjtcbiAgZm9yY2VGdWxsRGlzcGxheTogYm9vbGVhbjtcbiAgY2hhdFNldHRpbmc6IHN0cmluZztcbiAgbWVldGluZ0Rpc3BsYXlUeXBlOiBzdHJpbmc7XG4gIGF1ZGlvU2V0dGluZzogc3RyaW5nO1xuICB2aWRlb1NldHRpbmc6IHN0cmluZztcbiAgc2NyZWVuc2hhcmVTZXR0aW5nOiBzdHJpbmc7XG4gIGhQYXJhbXM6IEhQYXJhbXNUeXBlO1xuICB2UGFyYW1zOiBWUGFyYW1zVHlwZTtcbiAgc2NyZWVuUGFyYW1zOiBTY3JlZW5QYXJhbXNUeXBlO1xuICBhUGFyYW1zOiBBUGFyYW1zVHlwZTtcbiAgaXNsZXZlbDogc3RyaW5nO1xuICBzaG93QWxlcnQ/OiBTaG93QWxlcnQ7XG4gIGRhdGE6IFJlc3BvbnNlSm9pblJvb207XG5cbiAgLy8gdXBkYXRlIGZ1bmN0aW9uc1xuICB1cGRhdGVSdHBDYXBhYmlsaXRpZXM6IChydHBDYXBhYmlsaXRpZXM6IFJ0cENhcGFiaWxpdGllcyB8IG51bGwpID0+IHZvaWQ7XG4gIHVwZGF0ZVJvb21SZWN2SVBzOiAocm9vbVJlY3ZJUHM6IHN0cmluZ1tdKSA9PiB2b2lkO1xuICB1cGRhdGVNZWV0aW5nUm9vbVBhcmFtczogKHBhcmFtczogTWVldGluZ1Jvb21QYXJhbXMgfCBudWxsKSA9PiB2b2lkO1xuICB1cGRhdGVJdGVtUGFnZUxpbWl0OiAobGltaXQ6IG51bWJlcikgPT4gdm9pZDtcbiAgdXBkYXRlQXVkaW9Pbmx5Um9vbTogKGlzQXVkaW9Pbmx5OiBib29sZWFuKSA9PiB2b2lkO1xuICB1cGRhdGVBZGRGb3JCYXNpYzogKGFkZEZvckJhc2ljOiBib29sZWFuKSA9PiB2b2lkO1xuICB1cGRhdGVTY3JlZW5QYWdlTGltaXQ6IChsaW1pdDogbnVtYmVyKSA9PiB2b2lkO1xuICB1cGRhdGVWaWRDb25zOiAoY29uczogYW55KSA9PiB2b2lkO1xuICB1cGRhdGVGcmFtZVJhdGU6IChmcmFtZVJhdGU6IG51bWJlcikgPT4gdm9pZDtcbiAgdXBkYXRlQWRtaW5QYXNzY29kZTogKHBhc3Njb2RlOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHVwZGF0ZUV2ZW50VHlwZTogKGV2ZW50VHlwZTogRXZlbnRUeXBlKSA9PiB2b2lkO1xuICB1cGRhdGVZb3VBcmVDb0hvc3Q6IChjb0hvc3Q6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIHVwZGF0ZUF1dG9XYXZlOiAoYXV0b1dhdmU6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIHVwZGF0ZUZvcmNlRnVsbERpc3BsYXk6IChmb3JjZUZ1bGw6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIHVwZGF0ZUNoYXRTZXR0aW5nOiAoc2V0dGluZzogc3RyaW5nKSA9PiB2b2lkO1xuICB1cGRhdGVNZWV0aW5nRGlzcGxheVR5cGU6ICh0eXBlOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHVwZGF0ZUF1ZGlvU2V0dGluZzogKHNldHRpbmc6IHN0cmluZykgPT4gdm9pZDtcbiAgdXBkYXRlVmlkZW9TZXR0aW5nOiAoc2V0dGluZzogc3RyaW5nKSA9PiB2b2lkO1xuICB1cGRhdGVTY3JlZW5zaGFyZVNldHRpbmc6IChzZXR0aW5nOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHVwZGF0ZUhQYXJhbXM6IChwYXJhbXM6IEhQYXJhbXNUeXBlKSA9PiB2b2lkO1xuICB1cGRhdGVWUGFyYW1zOiAocGFyYW1zOiBWUGFyYW1zVHlwZSkgPT4gdm9pZDtcbiAgdXBkYXRlU2NyZWVuUGFyYW1zOiAocGFyYW1zOiBTY3JlZW5QYXJhbXNUeXBlKSA9PiB2b2lkO1xuICB1cGRhdGVBUGFyYW1zOiAocGFyYW1zOiBBUGFyYW1zVHlwZSkgPT4gdm9pZDtcbiAgdXBkYXRlTWFpbkhlaWdodFdpZHRoOiAoaGVpZ2h0V2lkdGg6IG51bWJlcikgPT4gdm9pZDtcbiAgdXBkYXRlVGFyZ2V0UmVzb2x1dGlvbjogKHJlc29sdXRpb246IHN0cmluZykgPT4gdm9pZDtcbiAgdXBkYXRlVGFyZ2V0UmVzb2x1dGlvbkhvc3Q6IChyZXNvbHV0aW9uOiBzdHJpbmcpID0+IHZvaWQ7XG5cbiAgLy8gUmVjb3JkaW5nLXJlbGF0ZWQgdXBkYXRlIGZ1bmN0aW9uc1xuICB1cGRhdGVSZWNvcmRpbmdBdWRpb1BhdXNlc0xpbWl0OiAobGltaXQ6IG51bWJlcikgPT4gdm9pZDtcbiAgdXBkYXRlUmVjb3JkaW5nQXVkaW9QYXVzZXNDb3VudDogKGNvdW50OiBudW1iZXIpID0+IHZvaWQ7XG4gIHVwZGF0ZVJlY29yZGluZ0F1ZGlvU3VwcG9ydDogKHN1cHBvcnQ6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIHVwZGF0ZVJlY29yZGluZ0F1ZGlvUGVvcGxlTGltaXQ6IChsaW1pdDogbnVtYmVyKSA9PiB2b2lkO1xuICB1cGRhdGVSZWNvcmRpbmdBdWRpb1BhcnRpY2lwYW50c1RpbWVMaW1pdDogKGxpbWl0OiBudW1iZXIpID0+IHZvaWQ7XG4gIHVwZGF0ZVJlY29yZGluZ1ZpZGVvUGF1c2VzQ291bnQ6IChjb3VudDogbnVtYmVyKSA9PiB2b2lkO1xuICB1cGRhdGVSZWNvcmRpbmdWaWRlb1BhdXNlc0xpbWl0OiAobGltaXQ6IG51bWJlcikgPT4gdm9pZDtcbiAgdXBkYXRlUmVjb3JkaW5nVmlkZW9TdXBwb3J0OiAoc3VwcG9ydDogYm9vbGVhbikgPT4gdm9pZDtcbiAgdXBkYXRlUmVjb3JkaW5nVmlkZW9QZW9wbGVMaW1pdDogKGxpbWl0OiBudW1iZXIpID0+IHZvaWQ7XG4gIHVwZGF0ZVJlY29yZGluZ1ZpZGVvUGFydGljaXBhbnRzVGltZUxpbWl0OiAobGltaXQ6IG51bWJlcikgPT4gdm9pZDtcbiAgdXBkYXRlUmVjb3JkaW5nQWxsUGFydGljaXBhbnRzU3VwcG9ydDogKHN1cHBvcnQ6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIHVwZGF0ZVJlY29yZGluZ1ZpZGVvUGFydGljaXBhbnRzU3VwcG9ydDogKHN1cHBvcnQ6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIHVwZGF0ZVJlY29yZGluZ0FsbFBhcnRpY2lwYW50c0Z1bGxSb29tU3VwcG9ydDogKHN1cHBvcnQ6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIHVwZGF0ZVJlY29yZGluZ1ZpZGVvUGFydGljaXBhbnRzRnVsbFJvb21TdXBwb3J0OiAoc3VwcG9ydDogYm9vbGVhbikgPT4gdm9pZDtcbiAgdXBkYXRlUmVjb3JkaW5nUHJlZmVycmVkT3JpZW50YXRpb246IChvcmllbnRhdGlvbjogc3RyaW5nKSA9PiB2b2lkO1xuICB1cGRhdGVSZWNvcmRpbmdTdXBwb3J0Rm9yT3RoZXJPcmllbnRhdGlvbjogKHN1cHBvcnQ6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIHVwZGF0ZVJlY29yZGluZ011bHRpRm9ybWF0c1N1cHBvcnQ6IChzdXBwb3J0OiBib29sZWFuKSA9PiB2b2lkO1xuICB1cGRhdGVSZWNvcmRpbmdWaWRlb09wdGlvbnM6IChvcHRpb25zOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHVwZGF0ZVJlY29yZGluZ0F1ZGlvT3B0aW9uczogKG9wdGlvbnM6IHN0cmluZykgPT4gdm9pZDtcbn1cblxuZXhwb3J0IHR5cGUgVXBkYXRlUm9vbVBhcmFtZXRlcnNDbGllbnRPcHRpb25zID0ge1xuICBwYXJhbWV0ZXJzOiBVcGRhdGVSb29tUGFyYW1ldGVyc0NsaWVudFBhcmFtZXRlcnM7XG59O1xuXG4vLyBFeHBvcnQgdGhlIHR5cGUgZGVmaW5pdGlvbiBmb3IgdGhlIGZ1bmN0aW9uXG5leHBvcnQgdHlwZSBVcGRhdGVSb29tUGFyYW1ldGVyc0NsaWVudFR5cGUgPSAob3B0aW9uczogVXBkYXRlUm9vbVBhcmFtZXRlcnNDbGllbnRPcHRpb25zKSA9PiB2b2lkO1xuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCcsXG59KVxuZXhwb3J0IGNsYXNzIFVwZGF0ZVJvb21QYXJhbWV0ZXJzQ2xpZW50IHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB2aWRlb0NhcHR1cmVDb25zdHJhaW50czogVmlkZW9DYXB0dXJlQ29uc3RyYWludHMsXG4gICAgcHJpdmF0ZSBoUGFyYW1zOiBIUGFyYW1zLFxuICAgIHByaXZhdGUgdlBhcmFtczogVlBhcmFtcyxcbiAgICBwcml2YXRlIHNjcmVlblBhcmFtczogU2NyZWVuUGFyYW1zLFxuICAgIHByaXZhdGUgYVBhcmFtczogQVBhcmFtcyxcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgUm9vbSBQYXJhbWV0ZXJzIENsaWVudCBhZnRlciB0aGUgdXNlciBoYXMgam9pbmVkIHRoZSByb29tIGFuZCB0aGUgcm9vbSBwYXJhbWV0ZXJzIGhhdmUgYmVlbiByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbWV0ZXJzIC0gQW4gb2JqZWN0IGNvbnRhaW5pbmcgdmFyaW91cyBwYXJhbWV0ZXJzIGFuZCB1cGRhdGUgZnVuY3Rpb25zLlxuICAgKi9cbiAgdXBkYXRlUm9vbVBhcmFtZXRlcnNDbGllbnQgPSAoeyBwYXJhbWV0ZXJzIH06IFVwZGF0ZVJvb21QYXJhbWV0ZXJzQ2xpZW50T3B0aW9ucyk6IHZvaWQgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIHNjcmVlblBhZ2VMaW1pdCxcbiAgICAgICAgc2hhcmVTY3JlZW5TdGFydGVkLFxuICAgICAgICBzaGFyZWQsXG5cbiAgICAgICAgaFBhcmFtcyxcbiAgICAgICAgdlBhcmFtcyxcbiAgICAgICAgZnJhbWVSYXRlLFxuXG4gICAgICAgIGlzbGV2ZWwsXG4gICAgICAgIHNob3dBbGVydCxcbiAgICAgICAgZGF0YSxcblxuICAgICAgICAvL3VwZGF0ZXNcbiAgICAgICAgdXBkYXRlUnRwQ2FwYWJpbGl0aWVzLFxuICAgICAgICB1cGRhdGVSb29tUmVjdklQcyxcbiAgICAgICAgdXBkYXRlTWVldGluZ1Jvb21QYXJhbXMsXG4gICAgICAgIHVwZGF0ZUl0ZW1QYWdlTGltaXQsXG4gICAgICAgIHVwZGF0ZUF1ZGlvT25seVJvb20sXG4gICAgICAgIHVwZGF0ZVNjcmVlblBhZ2VMaW1pdCxcbiAgICAgICAgdXBkYXRlVmlkQ29ucyxcbiAgICAgICAgdXBkYXRlRnJhbWVSYXRlLFxuICAgICAgICB1cGRhdGVBZG1pblBhc3Njb2RlLFxuICAgICAgICB1cGRhdGVFdmVudFR5cGUsXG4gICAgICAgIHVwZGF0ZVlvdUFyZUNvSG9zdCxcbiAgICAgICAgdXBkYXRlQXV0b1dhdmUsXG4gICAgICAgIHVwZGF0ZUZvcmNlRnVsbERpc3BsYXksXG4gICAgICAgIHVwZGF0ZUNoYXRTZXR0aW5nLFxuICAgICAgICB1cGRhdGVNZWV0aW5nRGlzcGxheVR5cGUsXG4gICAgICAgIHVwZGF0ZUF1ZGlvU2V0dGluZyxcbiAgICAgICAgdXBkYXRlVmlkZW9TZXR0aW5nLFxuICAgICAgICB1cGRhdGVTY3JlZW5zaGFyZVNldHRpbmcsXG4gICAgICAgIHVwZGF0ZUhQYXJhbXMsXG4gICAgICAgIHVwZGF0ZVZQYXJhbXMsXG4gICAgICAgIHVwZGF0ZVNjcmVlblBhcmFtcyxcbiAgICAgICAgdXBkYXRlQVBhcmFtcyxcbiAgICAgICAgdXBkYXRlVGFyZ2V0UmVzb2x1dGlvbixcbiAgICAgICAgdXBkYXRlVGFyZ2V0UmVzb2x1dGlvbkhvc3QsXG5cbiAgICAgICAgLy8gUmVjb3JkaW5nIHVwZGF0ZXNcbiAgICAgICAgdXBkYXRlUmVjb3JkaW5nQXVkaW9QYXVzZXNMaW1pdCxcbiAgICAgICAgdXBkYXRlUmVjb3JkaW5nQXVkaW9QYXVzZXNDb3VudCxcbiAgICAgICAgdXBkYXRlUmVjb3JkaW5nQXVkaW9TdXBwb3J0LFxuICAgICAgICB1cGRhdGVSZWNvcmRpbmdBdWRpb1Blb3BsZUxpbWl0LFxuICAgICAgICB1cGRhdGVSZWNvcmRpbmdBdWRpb1BhcnRpY2lwYW50c1RpbWVMaW1pdCxcbiAgICAgICAgdXBkYXRlUmVjb3JkaW5nVmlkZW9QYXVzZXNDb3VudCxcbiAgICAgICAgdXBkYXRlUmVjb3JkaW5nVmlkZW9QYXVzZXNMaW1pdCxcbiAgICAgICAgdXBkYXRlUmVjb3JkaW5nVmlkZW9TdXBwb3J0LFxuICAgICAgICB1cGRhdGVSZWNvcmRpbmdWaWRlb1Blb3BsZUxpbWl0LFxuICAgICAgICB1cGRhdGVSZWNvcmRpbmdWaWRlb1BhcnRpY2lwYW50c1RpbWVMaW1pdCxcbiAgICAgICAgdXBkYXRlUmVjb3JkaW5nQWxsUGFydGljaXBhbnRzU3VwcG9ydCxcbiAgICAgICAgdXBkYXRlUmVjb3JkaW5nVmlkZW9QYXJ0aWNpcGFudHNTdXBwb3J0LFxuICAgICAgICB1cGRhdGVSZWNvcmRpbmdBbGxQYXJ0aWNpcGFudHNGdWxsUm9vbVN1cHBvcnQsXG4gICAgICAgIHVwZGF0ZVJlY29yZGluZ1ZpZGVvUGFydGljaXBhbnRzRnVsbFJvb21TdXBwb3J0LFxuICAgICAgICB1cGRhdGVSZWNvcmRpbmdQcmVmZXJyZWRPcmllbnRhdGlvbixcbiAgICAgICAgdXBkYXRlUmVjb3JkaW5nU3VwcG9ydEZvck90aGVyT3JpZW50YXRpb24sXG4gICAgICAgIHVwZGF0ZVJlY29yZGluZ011bHRpRm9ybWF0c1N1cHBvcnQsXG4gICAgICAgIHVwZGF0ZVJlY29yZGluZ1ZpZGVvT3B0aW9ucyxcbiAgICAgICAgdXBkYXRlUmVjb3JkaW5nQXVkaW9PcHRpb25zLFxuICAgICAgICB1cGRhdGVNYWluSGVpZ2h0V2lkdGgsXG4gICAgICB9ID0gcGFyYW1ldGVycztcblxuICAgICAgaWYgKGRhdGEucnRwQ2FwYWJpbGl0aWVzID09IG51bGwpIHtcbiAgICAgICAgbGV0IHJlYXNvbiA9IGRhdGEucmVhc29uIHx8ICcnO1xuICAgICAgICBzaG93QWxlcnQ/Lih7XG4gICAgICAgICAgbWVzc2FnZTogJ1NvcnJ5LCB5b3UgYXJlIG5vdCBhbGxvd2VkIHRvIGpvaW4gdGhpcyByb29tLiAnICsgcmVhc29uLFxuICAgICAgICAgIHR5cGU6ICdkYW5nZXInLFxuICAgICAgICAgIGR1cmF0aW9uOiAzMDAwLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgYWxsIHZhbHVlc1xuICAgICAgdXBkYXRlUnRwQ2FwYWJpbGl0aWVzKGRhdGEucnRwQ2FwYWJpbGl0aWVzKTtcbiAgICAgIHVwZGF0ZUFkbWluUGFzc2NvZGUoZGF0YS5zZWN1cmVDb2RlKTtcbiAgICAgIHVwZGF0ZVJvb21SZWN2SVBzKGRhdGEucm9vbVJlY3ZJUHMpO1xuICAgICAgdXBkYXRlTWVldGluZ1Jvb21QYXJhbXMoZGF0YS5tZWV0aW5nUm9vbVBhcmFtcyk7XG5cbiAgICAgIC8vIFVwZGF0ZSByZWNvcmRpbmcgdmFsdWVzXG4gICAgICB1cGRhdGVSZWNvcmRpbmdBdWRpb1BhdXNlc0xpbWl0KGRhdGEucmVjb3JkaW5nUGFyYW1zLnJlY29yZGluZ0F1ZGlvUGF1c2VzTGltaXQpO1xuICAgICAgdXBkYXRlUmVjb3JkaW5nQXVkaW9QYXVzZXNDb3VudChkYXRhLnJlY29yZGluZ1BhcmFtcy5yZWNvcmRpbmdBdWRpb1BhdXNlc0NvdW50ISk7XG4gICAgICB1cGRhdGVSZWNvcmRpbmdBdWRpb1N1cHBvcnQoZGF0YS5yZWNvcmRpbmdQYXJhbXMucmVjb3JkaW5nQXVkaW9TdXBwb3J0KTtcbiAgICAgIHVwZGF0ZVJlY29yZGluZ0F1ZGlvUGVvcGxlTGltaXQoZGF0YS5yZWNvcmRpbmdQYXJhbXMucmVjb3JkaW5nQXVkaW9QZW9wbGVMaW1pdCk7XG4gICAgICB1cGRhdGVSZWNvcmRpbmdBdWRpb1BhcnRpY2lwYW50c1RpbWVMaW1pdChcbiAgICAgICAgZGF0YS5yZWNvcmRpbmdQYXJhbXMucmVjb3JkaW5nQXVkaW9QYXJ0aWNpcGFudHNUaW1lTGltaXQsXG4gICAgICApO1xuICAgICAgdXBkYXRlUmVjb3JkaW5nVmlkZW9QYXVzZXNDb3VudChkYXRhLnJlY29yZGluZ1BhcmFtcy5yZWNvcmRpbmdWaWRlb1BhdXNlc0NvdW50ISk7XG4gICAgICB1cGRhdGVSZWNvcmRpbmdWaWRlb1BhdXNlc0xpbWl0KGRhdGEucmVjb3JkaW5nUGFyYW1zLnJlY29yZGluZ1ZpZGVvUGF1c2VzTGltaXQpO1xuICAgICAgdXBkYXRlUmVjb3JkaW5nVmlkZW9TdXBwb3J0KGRhdGEucmVjb3JkaW5nUGFyYW1zLnJlY29yZGluZ1ZpZGVvU3VwcG9ydCk7XG4gICAgICB1cGRhdGVSZWNvcmRpbmdWaWRlb1Blb3BsZUxpbWl0KGRhdGEucmVjb3JkaW5nUGFyYW1zLnJlY29yZGluZ1ZpZGVvUGVvcGxlTGltaXQpO1xuICAgICAgdXBkYXRlUmVjb3JkaW5nVmlkZW9QYXJ0aWNpcGFudHNUaW1lTGltaXQoXG4gICAgICAgIGRhdGEucmVjb3JkaW5nUGFyYW1zLnJlY29yZGluZ1ZpZGVvUGFydGljaXBhbnRzVGltZUxpbWl0LFxuICAgICAgKTtcbiAgICAgIHVwZGF0ZVJlY29yZGluZ0FsbFBhcnRpY2lwYW50c1N1cHBvcnQoZGF0YS5yZWNvcmRpbmdQYXJhbXMucmVjb3JkaW5nQWxsUGFydGljaXBhbnRzU3VwcG9ydCk7XG4gICAgICB1cGRhdGVSZWNvcmRpbmdWaWRlb1BhcnRpY2lwYW50c1N1cHBvcnQoXG4gICAgICAgIGRhdGEucmVjb3JkaW5nUGFyYW1zLnJlY29yZGluZ1ZpZGVvUGFydGljaXBhbnRzU3VwcG9ydCxcbiAgICAgICk7XG4gICAgICB1cGRhdGVSZWNvcmRpbmdBbGxQYXJ0aWNpcGFudHNGdWxsUm9vbVN1cHBvcnQoXG4gICAgICAgIGRhdGEucmVjb3JkaW5nUGFyYW1zLnJlY29yZGluZ0FsbFBhcnRpY2lwYW50c0Z1bGxSb29tU3VwcG9ydCxcbiAgICAgICk7XG4gICAgICB1cGRhdGVSZWNvcmRpbmdWaWRlb1BhcnRpY2lwYW50c0Z1bGxSb29tU3VwcG9ydChcbiAgICAgICAgZGF0YS5yZWNvcmRpbmdQYXJhbXMucmVjb3JkaW5nVmlkZW9QYXJ0aWNpcGFudHNGdWxsUm9vbVN1cHBvcnQsXG4gICAgICApO1xuICAgICAgdXBkYXRlUmVjb3JkaW5nUHJlZmVycmVkT3JpZW50YXRpb24oZGF0YS5yZWNvcmRpbmdQYXJhbXMucmVjb3JkaW5nUHJlZmVycmVkT3JpZW50YXRpb24pO1xuICAgICAgdXBkYXRlUmVjb3JkaW5nU3VwcG9ydEZvck90aGVyT3JpZW50YXRpb24oXG4gICAgICAgIGRhdGEucmVjb3JkaW5nUGFyYW1zLnJlY29yZGluZ1N1cHBvcnRGb3JPdGhlck9yaWVudGF0aW9uLFxuICAgICAgKTtcbiAgICAgIHVwZGF0ZVJlY29yZGluZ011bHRpRm9ybWF0c1N1cHBvcnQoZGF0YS5yZWNvcmRpbmdQYXJhbXMucmVjb3JkaW5nTXVsdGlGb3JtYXRzU3VwcG9ydCk7XG5cbiAgICAgIC8vIFVwZGF0ZSBvdGhlciBtZWV0aW5nIHJvb20gc2V0dGluZ3NcbiAgICAgIHVwZGF0ZUl0ZW1QYWdlTGltaXQoZGF0YS5tZWV0aW5nUm9vbVBhcmFtcy5pdGVtUGFnZUxpbWl0KTtcbiAgICAgIHVwZGF0ZUV2ZW50VHlwZShkYXRhLm1lZXRpbmdSb29tUGFyYW1zLnR5cGUpO1xuXG4gICAgICBpZiAoZGF0YS5tZWV0aW5nUm9vbVBhcmFtcy50eXBlID09ICdjaGF0JyAmJiBpc2xldmVsICE9ICcyJykge1xuICAgICAgICB1cGRhdGVZb3VBcmVDb0hvc3QodHJ1ZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChbJ2NoYXQnLCAnYnJvYWRjYXN0J10uaW5jbHVkZXMoZGF0YS5tZWV0aW5nUm9vbVBhcmFtcy50eXBlKSkge1xuICAgICAgICB1cGRhdGVBdXRvV2F2ZShmYWxzZSk7XG4gICAgICAgIHVwZGF0ZU1lZXRpbmdEaXNwbGF5VHlwZSgnYWxsJyk7XG4gICAgICAgIHVwZGF0ZUZvcmNlRnVsbERpc3BsYXkodHJ1ZSk7XG4gICAgICAgIHVwZGF0ZUNoYXRTZXR0aW5nKCdhbGxvdycpO1xuICAgICAgfVxuXG4gICAgICB1cGRhdGVBdWRpb1NldHRpbmcoZGF0YS5tZWV0aW5nUm9vbVBhcmFtcy5hdWRpb1NldHRpbmcpO1xuICAgICAgdXBkYXRlVmlkZW9TZXR0aW5nKGRhdGEubWVldGluZ1Jvb21QYXJhbXMudmlkZW9TZXR0aW5nKTtcbiAgICAgIHVwZGF0ZVNjcmVlbnNoYXJlU2V0dGluZyhkYXRhLm1lZXRpbmdSb29tUGFyYW1zLnNjcmVlbnNoYXJlU2V0dGluZyk7XG4gICAgICB1cGRhdGVDaGF0U2V0dGluZyhkYXRhLm1lZXRpbmdSb29tUGFyYW1zLmNoYXRTZXR0aW5nKTtcblxuICAgICAgdXBkYXRlQXVkaW9Pbmx5Um9vbShkYXRhLm1lZXRpbmdSb29tUGFyYW1zLm1lZGlhVHlwZSAhPSAndmlkZW8nKTtcblxuICAgICAgaWYgKGRhdGEubWVldGluZ1Jvb21QYXJhbXMudHlwZSA9PSAnY2hhdCcgfHwgZGF0YS5tZWV0aW5nUm9vbVBhcmFtcy50eXBlID09ICdicm9hZGNhc3QnKSB7XG4gICAgICAgIGlmIChkYXRhLm1lZXRpbmdSb29tUGFyYW1zLnR5cGUgPT0gJ2Jyb2FkY2FzdCcpIHtcbiAgICAgICAgICB1cGRhdGVJdGVtUGFnZUxpbWl0KDEpO1xuICAgICAgICAgIHVwZGF0ZVJlY29yZGluZ1ZpZGVvT3B0aW9ucygnbWFpblNjcmVlbicpO1xuICAgICAgICAgIHVwZGF0ZVJlY29yZGluZ0F1ZGlvT3B0aW9ucygnaG9zdCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHVwZGF0ZUl0ZW1QYWdlTGltaXQoMik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGRhdGEubWVldGluZ1Jvb21QYXJhbXMudHlwZSA9PSAnY29uZmVyZW5jZScgJiYgKHNoYXJlZCB8fCBzaGFyZVNjcmVlblN0YXJ0ZWQpKSB7XG4gICAgICAgIHVwZGF0ZU1haW5IZWlnaHRXaWR0aCgxMDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdXBkYXRlTWFpbkhlaWdodFdpZHRoKDApO1xuICAgICAgfVxuXG4gICAgICB1cGRhdGVTY3JlZW5QYWdlTGltaXQoTWF0aC5taW4oZGF0YS5tZWV0aW5nUm9vbVBhcmFtcy5pdGVtUGFnZUxpbWl0LCBzY3JlZW5QYWdlTGltaXQpKTtcblxuICAgICAgLy8gQXNzaWduIG1lZGlhIGNhcHR1cmUgY29uc3RyYWludHMgYmFzZWQgb24gdGhlIHVzZXIncyByb2xlIGFuZCByb29tIHNldHRpbmdzXG4gICAgICBsZXQgdGFyZ2V0T3JpZW50YXRpb24gPVxuICAgICAgICBpc2xldmVsID09ICcyJ1xuICAgICAgICAgID8gZGF0YS5tZWV0aW5nUm9vbVBhcmFtcy50YXJnZXRPcmllbnRhdGlvbkhvc3RcbiAgICAgICAgICA6IGRhdGEubWVldGluZ1Jvb21QYXJhbXMudGFyZ2V0T3JpZW50YXRpb247XG4gICAgICBsZXQgdGFyZ2V0UmVzb2x1dGlvbiA9XG4gICAgICAgIGlzbGV2ZWwgPT0gJzInXG4gICAgICAgICAgPyBkYXRhLm1lZXRpbmdSb29tUGFyYW1zLnRhcmdldFJlc29sdXRpb25Ib3N0XG4gICAgICAgICAgOiBkYXRhLm1lZXRpbmdSb29tUGFyYW1zLnRhcmdldFJlc29sdXRpb247XG5cbiAgICAgIGxldCB2aWRDb25zOiBWaWRDb25zO1xuICAgICAgaWYgKHRhcmdldE9yaWVudGF0aW9uID09ICdsYW5kc2NhcGUnKSB7XG4gICAgICAgIHZpZENvbnMgPVxuICAgICAgICAgIHRhcmdldFJlc29sdXRpb24gPT0gJ2hkJ1xuICAgICAgICAgICAgPyB0aGlzLnZpZGVvQ2FwdHVyZUNvbnN0cmFpbnRzLmhkQ29uc1xuICAgICAgICAgICAgOiB0YXJnZXRSZXNvbHV0aW9uID09ICdRbkhEJ1xuICAgICAgICAgICAgPyB0aGlzLnZpZGVvQ2FwdHVyZUNvbnN0cmFpbnRzLlFuSERDb25zXG4gICAgICAgICAgICA6IHRhcmdldFJlc29sdXRpb24gPT0gJ2ZoZCdcbiAgICAgICAgICAgID8gdGhpcy52aWRlb0NhcHR1cmVDb25zdHJhaW50cy5maGRDb25zXG4gICAgICAgICAgICA6IHRhcmdldFJlc29sdXRpb24gPT0gJ3FoZCdcbiAgICAgICAgICAgID8gdGhpcy52aWRlb0NhcHR1cmVDb25zdHJhaW50cy5xaGRDb25zXG4gICAgICAgICAgICA6IHRoaXMudmlkZW9DYXB0dXJlQ29uc3RyYWludHMuc2RDb25zO1xuICAgICAgfSBlbHNlIGlmICh0YXJnZXRPcmllbnRhdGlvbiA9PSAnbmV1dHJhbCcpIHtcbiAgICAgICAgdmlkQ29ucyA9XG4gICAgICAgICAgdGFyZ2V0UmVzb2x1dGlvbiA9PSAnaGQnXG4gICAgICAgICAgICA/IHRoaXMudmlkZW9DYXB0dXJlQ29uc3RyYWludHMuaGRDb25zTmV1XG4gICAgICAgICAgICA6IHRhcmdldFJlc29sdXRpb24gPT0gJ1FuSEQnXG4gICAgICAgICAgICA/IHRoaXMudmlkZW9DYXB0dXJlQ29uc3RyYWludHMuUW5IRENvbnNOZXVcbiAgICAgICAgICAgIDogdGFyZ2V0UmVzb2x1dGlvbiA9PSAnZmhkJ1xuICAgICAgICAgICAgPyB0aGlzLnZpZGVvQ2FwdHVyZUNvbnN0cmFpbnRzLmZoZENvbnNOZXVcbiAgICAgICAgICAgIDogdGFyZ2V0UmVzb2x1dGlvbiA9PSAncWhkJ1xuICAgICAgICAgICAgPyB0aGlzLnZpZGVvQ2FwdHVyZUNvbnN0cmFpbnRzLnFoZENvbnNOZXVcbiAgICAgICAgICAgIDogdGhpcy52aWRlb0NhcHR1cmVDb25zdHJhaW50cy5zZENvbnNOZXU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2aWRDb25zID1cbiAgICAgICAgICB0YXJnZXRSZXNvbHV0aW9uID09ICdoZCdcbiAgICAgICAgICAgID8gdGhpcy52aWRlb0NhcHR1cmVDb25zdHJhaW50cy5oZENvbnNQb3J0XG4gICAgICAgICAgICA6IHRhcmdldFJlc29sdXRpb24gPT0gJ1FuSEQnXG4gICAgICAgICAgICA/IHRoaXMudmlkZW9DYXB0dXJlQ29uc3RyYWludHMuUW5IRENvbnNQb3J0XG4gICAgICAgICAgICA6IHRhcmdldFJlc29sdXRpb24gPT0gJ2ZoZCdcbiAgICAgICAgICAgID8gdGhpcy52aWRlb0NhcHR1cmVDb25zdHJhaW50cy5maGRDb25zUG9ydFxuICAgICAgICAgICAgOiB0YXJnZXRSZXNvbHV0aW9uID09ICdxaGQnXG4gICAgICAgICAgICA/IHRoaXMudmlkZW9DYXB0dXJlQ29uc3RyYWludHMucWhkQ29uc1BvcnRcbiAgICAgICAgICAgIDogdGhpcy52aWRlb0NhcHR1cmVDb25zdHJhaW50cy5zZENvbnNQb3J0O1xuICAgICAgfVxuXG4gICAgICBsZXQgZnJhbWVSYXRlVmFsdWUgPSBmcmFtZVJhdGUgPyBmcmFtZVJhdGUgOiAxMDtcblxuICAgICAgbGV0IHZQYXJhbXNWYWx1ZSA9IHsgLi4udlBhcmFtcyB9O1xuICAgICAgbGV0IGhQYXJhbXNWYWx1ZSA9IHsgLi4uaFBhcmFtcyB9O1xuICAgICAgaWYgKE9iamVjdC5rZXlzKHZQYXJhbXNWYWx1ZSkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHZQYXJhbXNWYWx1ZSA9IHRoaXMudlBhcmFtcy52UGFyYW1zO1xuICAgICAgfVxuICAgICAgaWYgKE9iamVjdC5rZXlzKGhQYXJhbXNWYWx1ZSkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGhQYXJhbXNWYWx1ZSA9IHRoaXMuaFBhcmFtcy5oUGFyYW1zO1xuICAgICAgfVxuXG4gICAgICBpZiAodGFyZ2V0UmVzb2x1dGlvbiA9PSAnaGQnKSB7XG4gICAgICAgIGZyYW1lUmF0ZVZhbHVlID0gdGhpcy52aWRlb0NhcHR1cmVDb25zdHJhaW50cy5oZEZyYW1lUmF0ZTtcblxuICAgICAgICB2UGFyYW1zVmFsdWUuZW5jb2RpbmdzLmZvckVhY2goKGVuY29kaW5nOiBQYXJ0aWFsPFZQYXJhbXNUeXBlWydlbmNvZGluZ3MnXVswXT4pID0+IHtcbiAgICAgICAgICBlbmNvZGluZy5tYXhCaXRyYXRlICYmIChlbmNvZGluZy5tYXhCaXRyYXRlICo9IDQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBoUGFyYW1zVmFsdWUuZW5jb2RpbmdzLmZvckVhY2goKGVuY29kaW5nOiBQYXJ0aWFsPEhQYXJhbXNUeXBlWydlbmNvZGluZ3MnXVswXT4pID0+IHtcbiAgICAgICAgICBlbmNvZGluZy5tYXhCaXRyYXRlICYmIChlbmNvZGluZy5tYXhCaXRyYXRlICo9IDQpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAodGFyZ2V0UmVzb2x1dGlvbiA9PSAnUW5IRCcpIHtcbiAgICAgICAgZnJhbWVSYXRlVmFsdWUgPSB0aGlzLnZpZGVvQ2FwdHVyZUNvbnN0cmFpbnRzLlFuSERGcmFtZVJhdGU7XG4gICAgICAgIHZQYXJhbXNWYWx1ZS5lbmNvZGluZ3MuZm9yRWFjaCgoZW5jb2Rpbmc6IFBhcnRpYWw8VlBhcmFtc1R5cGVbJ2VuY29kaW5ncyddWzBdPikgPT4ge1xuICAgICAgICAgIGVuY29kaW5nLm1heEJpdHJhdGUgJiYgKGVuY29kaW5nLm1heEJpdHJhdGUgKj0gMC4yNSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGhQYXJhbXNWYWx1ZS5lbmNvZGluZ3MuZm9yRWFjaCgoZW5jb2Rpbmc6IFBhcnRpYWw8SFBhcmFtc1R5cGVbJ2VuY29kaW5ncyddWzBdPikgPT4ge1xuICAgICAgICAgIGVuY29kaW5nLm1heEJpdHJhdGUgJiYgKGVuY29kaW5nLm1heEJpdHJhdGUgKj0gMC4yNSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGhQYXJhbXNWYWx1ZS5jb2RlY09wdGlvbnMhLnZpZGVvR29vZ2xlU3RhcnRCaXRyYXRlISAqPSAwLjI1O1xuICAgICAgICB2UGFyYW1zVmFsdWUuY29kZWNPcHRpb25zIS52aWRlb0dvb2dsZVN0YXJ0Qml0cmF0ZSEgKj0gMC4yNTtcbiAgICAgIH0gZWxzZSBpZiAodGFyZ2V0UmVzb2x1dGlvbiA9PSAnZmhkJykge1xuICAgICAgICBmcmFtZVJhdGVWYWx1ZSA9IHRoaXMudmlkZW9DYXB0dXJlQ29uc3RyYWludHMuZmhkRnJhbWVSYXRlO1xuICAgICAgICB2UGFyYW1zVmFsdWUuZW5jb2RpbmdzLmZvckVhY2goKGVuY29kaW5nOiBQYXJ0aWFsPFZQYXJhbXNUeXBlWydlbmNvZGluZ3MnXVswXT4pID0+IHtcbiAgICAgICAgICBlbmNvZGluZy5tYXhCaXRyYXRlICYmIChlbmNvZGluZy5tYXhCaXRyYXRlICo9IDgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBoUGFyYW1zVmFsdWUuZW5jb2RpbmdzLmZvckVhY2goKGVuY29kaW5nOiBQYXJ0aWFsPEhQYXJhbXNUeXBlWydlbmNvZGluZ3MnXVswXT4pID0+IHtcbiAgICAgICAgICBlbmNvZGluZy5tYXhCaXRyYXRlICYmIChlbmNvZGluZy5tYXhCaXRyYXRlICo9IDgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBoUGFyYW1zVmFsdWUuY29kZWNPcHRpb25zIS52aWRlb0dvb2dsZVN0YXJ0Qml0cmF0ZSEgKj0gODtcbiAgICAgICAgdlBhcmFtc1ZhbHVlLmNvZGVjT3B0aW9ucyEudmlkZW9Hb29nbGVTdGFydEJpdHJhdGUhICo9IDg7XG4gICAgICB9IGVsc2UgaWYgKHRhcmdldFJlc29sdXRpb24gPT0gJ3FoZCcpIHtcbiAgICAgICAgZnJhbWVSYXRlVmFsdWUgPSB0aGlzLnZpZGVvQ2FwdHVyZUNvbnN0cmFpbnRzLnFoZEZyYW1lUmF0ZTtcbiAgICAgICAgdlBhcmFtc1ZhbHVlLmVuY29kaW5ncy5mb3JFYWNoKChlbmNvZGluZzogUGFydGlhbDxWUGFyYW1zVHlwZVsnZW5jb2RpbmdzJ11bMF0+KSA9PiB7XG4gICAgICAgICAgZW5jb2RpbmcubWF4Qml0cmF0ZSAmJiAoZW5jb2RpbmcubWF4Qml0cmF0ZSAqPSAxNik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGhQYXJhbXNWYWx1ZS5lbmNvZGluZ3MuZm9yRWFjaCgoZW5jb2Rpbmc6IFBhcnRpYWw8SFBhcmFtc1R5cGVbJ2VuY29kaW5ncyddWzBdPikgPT4ge1xuICAgICAgICAgIGVuY29kaW5nLm1heEJpdHJhdGUgJiYgKGVuY29kaW5nLm1heEJpdHJhdGUgKj0gMTYpO1xuICAgICAgICB9KTtcblxuICAgICAgICBoUGFyYW1zVmFsdWUuY29kZWNPcHRpb25zIS52aWRlb0dvb2dsZVN0YXJ0Qml0cmF0ZSEgKj0gMTY7XG4gICAgICAgIHZQYXJhbXNWYWx1ZS5jb2RlY09wdGlvbnMhLnZpZGVvR29vZ2xlU3RhcnRCaXRyYXRlISAqPSAxNjtcbiAgICAgIH1cblxuICAgICAgaWYgKGRhdGEucmVjb3JkaW5nUGFyYW1zLnJlY29yZGluZ1ZpZGVvU3VwcG9ydCkge1xuICAgICAgICB2UGFyYW1zVmFsdWUuZW5jb2RpbmdzLmZvckVhY2goKGVuY29kaW5nOiBQYXJ0aWFsPFZQYXJhbXNUeXBlWydlbmNvZGluZ3MnXVswXT4pID0+IHtcbiAgICAgICAgICBlbmNvZGluZy5tYXhCaXRyYXRlICYmIChlbmNvZGluZy5tYXhCaXRyYXRlICo9IDEuMik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGhQYXJhbXNWYWx1ZS5lbmNvZGluZ3MuZm9yRWFjaCgoZW5jb2Rpbmc6IFBhcnRpYWw8SFBhcmFtc1R5cGVbJ2VuY29kaW5ncyddWzBdPikgPT4ge1xuICAgICAgICAgIGVuY29kaW5nLm1heEJpdHJhdGUgJiYgKGVuY29kaW5nLm1heEJpdHJhdGUgKj0gMS4yKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaFBhcmFtc1ZhbHVlLmNvZGVjT3B0aW9ucyEudmlkZW9Hb29nbGVTdGFydEJpdHJhdGUhICo9IDEuMjtcbiAgICAgICAgdlBhcmFtc1ZhbHVlLmNvZGVjT3B0aW9ucyEudmlkZW9Hb29nbGVTdGFydEJpdHJhdGUhICo9IDEuMjtcbiAgICAgIH1cblxuICAgICAgdXBkYXRlVmlkQ29ucyh2aWRDb25zKTtcbiAgICAgIHVwZGF0ZUZyYW1lUmF0ZShmcmFtZVJhdGVWYWx1ZSk7XG4gICAgICB1cGRhdGVIUGFyYW1zKGhQYXJhbXNWYWx1ZSk7XG4gICAgICB1cGRhdGVWUGFyYW1zKHZQYXJhbXNWYWx1ZSk7XG4gICAgICB1cGRhdGVTY3JlZW5QYXJhbXModGhpcy5zY3JlZW5QYXJhbXMuc2NyZWVuUGFyYW1zKTtcbiAgICAgIHVwZGF0ZUFQYXJhbXModGhpcy5hUGFyYW1zLmFQYXJhbXMpO1xuICAgICAgdXBkYXRlVGFyZ2V0UmVzb2x1dGlvbihkYXRhLm1lZXRpbmdSb29tUGFyYW1zLnRhcmdldFJlc29sdXRpb24pO1xuICAgICAgdXBkYXRlVGFyZ2V0UmVzb2x1dGlvbkhvc3QoZGF0YS5tZWV0aW5nUm9vbVBhcmFtcy50YXJnZXRSZXNvbHV0aW9uSG9zdCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKCd1cGRhdGVSb29tUGFyYW1ldGVyc0NsaWVudCBlcnJvcicsIGVycm9yKTtcbiAgICAgIHBhcmFtZXRlcnMuc2hvd0FsZXJ0Py4oe1xuICAgICAgICBtZXNzYWdlOiAoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2UsXG4gICAgICAgIHR5cGU6ICdkYW5nZXInLFxuICAgICAgICBkdXJhdGlvbjogMzAwMCxcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcbn1cbiJdfQ==